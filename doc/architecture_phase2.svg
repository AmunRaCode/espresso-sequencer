<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1058px" preserveAspectRatio="none" style="width:1768px;height:1058px;background:#FFFFFF;" version="1.1" viewBox="0 0 1768 1058" width="1768px" zoomAndPan="magnify"><defs/><g><!--MD5=[f7217341b3bb6bbf768c7f0e049f8d09]
cluster Legend--><g id="cluster_Legend"><rect fill="none" height="106" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1.0;" width="474" x="7" y="8.5"/><path d="M68,8.5 L68,17.9883 L58,27.9883 L7,27.9883 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="51" x="10" y="23.0352">Legend</text></g><!--MD5=[3746f487d7820090e32c72dc756be46d]
cluster HotShotExternal--><g id="cluster_HotShotExternal"><path d="M1626.5,467 L1748.5,467 A3.75,3.75 0 0 1 1751,469.5 L1758,505.9766 L1758.5,505.9766 A2.5,2.5 0 0 1 1761,508.4766 L1761,602.5 A2.5,2.5 0 0 1 1758.5,605 L1626.5,605 A2.5,2.5 0 0 1 1624,602.5 L1624,469.5 A2.5,2.5 0 0 1 1626.5,467 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1624" x2="1758" y1="505.9766" y2="505.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="58" x="1659.5" y="482.5352">HotShot</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="121" x="1628" y="499.0234">(other instances)</text></g><!--MD5=[074479fc2b8718e85f223949db21494f]
cluster Decentralized Sequencer--><g id="cluster_Decentralized Sequencer"><path d="M1221.5,354 L1397.5,354 A3.75,3.75 0 0 1 1400,356.5 L1407,376.4883 L1597.5,376.4883 A2.5,2.5 0 0 1 1600,378.9883 L1600,843.5 A2.5,2.5 0 0 1 1597.5,846 L1221.5,846 A2.5,2.5 0 0 1 1219,843.5 L1219,356.5 A2.5,2.5 0 0 1 1221.5,354 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1219" x2="1407" y1="376.4883" y2="376.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="175" x="1223" y="369.5352">Decentralized Sequencer</text></g><!--MD5=[bcfbdd31683a7d01cd062dc0c4be3661]
cluster zkApp--><g id="cluster_zkApp"><path d="M1245.5,397 L1325.5,397 A3.75,3.75 0 0 1 1328,399.5 L1335,419.4883 L1573.5,419.4883 A2.5,2.5 0 0 1 1576,421.9883 L1576,819.5 A2.5,2.5 0 0 1 1573.5,822 L1245.5,822 A2.5,2.5 0 0 1 1243,819.5 L1243,399.5 A2.5,2.5 0 0 1 1245.5,397 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1243" x2="1335" y1="419.4883" y2="419.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="79" x="1247" y="412.5352">zkEVM app</text></g><!--MD5=[975d7fda8cf98ff1a26ca528bf10cecf]
cluster App--><g id="cluster_App"><path d="M1277.5,448 L1469.5,448 A3.75,3.75 0 0 1 1472,450.5 L1479,470.4883 L1541.5,470.4883 A2.5,2.5 0 0 1 1544,472.9883 L1544,634.5 A2.5,2.5 0 0 1 1541.5,637 L1277.5,637 A2.5,2.5 0 0 1 1275,634.5 L1275,450.5 A2.5,2.5 0 0 1 1277.5,448 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1275" x2="1479" y1="470.4883" y2="470.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="191" x="1279" y="463.5352">Txn-ordering HotShot app</text></g><!--MD5=[583d55fc1e2a49743832e160d5573292]
cluster HotShot--><g id="cluster_HotShot"><path d="M1317.5,499 L1376.5,499 A3.75,3.75 0 0 1 1379,501.5 L1386,521.4883 L1509.5,521.4883 A2.5,2.5 0 0 1 1512,523.9883 L1512,602.5 A2.5,2.5 0 0 1 1509.5,605 L1317.5,605 A2.5,2.5 0 0 1 1315,602.5 L1315,501.5 A2.5,2.5 0 0 1 1317.5,499 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1315" x2="1386" y1="521.4883" y2="521.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="58" x="1319" y="514.5352">HotShot</text></g><!--MD5=[6d298098a9fb99b91beb7284131f18dc]
cluster Adaptor--><g id="cluster_Adaptor"><path d="M1094.5,717 L1174.5,717 A3.75,3.75 0 0 1 1177,719.5 L1184,739.4883 L1184.5,739.4883 A2.5,2.5 0 0 1 1187,741.9883 L1187,818.5 A2.5,2.5 0 0 1 1184.5,821 L1094.5,821 A2.5,2.5 0 0 1 1092,818.5 L1092,719.5 A2.5,2.5 0 0 1 1094.5,717 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1092" x2="1184" y1="739.4883" y2="739.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="79" x="1096" y="732.5352">L2 Adaptor</text></g><!--MD5=[4499c58aefeb8777a4ef8729a6b9746a]
cluster L1--><g id="cluster_L1"><path d="M603.5,910 L694.5,910 A3.75,3.75 0 0 1 697,912.5 L704,932.4883 L1111.5,932.4883 A2.5,2.5 0 0 1 1114,934.9883 L1114,1048.5 A2.5,2.5 0 0 1 1111.5,1051 L603.5,1051 A2.5,2.5 0 0 1 601,1048.5 L601,912.5 A2.5,2.5 0 0 1 603.5,910 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="601" x2="704" y1="932.4883" y2="932.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="90" x="605" y="925.5352">Ethereum L1</text></g><!--MD5=[30107c386ad61863a1077fa9b8608265]
cluster L2--><g id="cluster_L2"><path d="M507.5,6 L631.5,6 A3.75,3.75 0 0 1 634,8.5 L641,28.4883 L1057.5,28.4883 A2.5,2.5 0 0 1 1060,30.9883 L1060,829.5 A2.5,2.5 0 0 1 1057.5,832 L507.5,832 A2.5,2.5 0 0 1 505,829.5 L505,8.5 A2.5,2.5 0 0 1 507.5,6 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="505" x2="641" y1="28.4883" y2="28.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123" x="509" y="21.5352">L2 (zkevm-node)</text></g><!--MD5=[72078431e26b572f5b2226d95bfc722b]
cluster HermezProver--><g id="cluster_HermezProver"><path d="M689.5,486 L796.5,486 A3.75,3.75 0 0 1 799,488.5 L806,508.4883 L1033.5,508.4883 A2.5,2.5 0 0 1 1036,510.9883 L1036,615.5 A2.5,2.5 0 0 1 1033.5,618 L689.5,618 A2.5,2.5 0 0 1 687,615.5 L687,488.5 A2.5,2.5 0 0 1 689.5,486 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="687" x2="806" y1="508.4883" y2="508.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="106" x="691" y="501.5352">Hermez Prover</text></g><!--MD5=[72d9b9c3df19f32920b704ceb461b044]
entity Original--><g id="elem_Original"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="106.5" y="62.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="116.5" y="86.0352">zkevm-node "as is"</text></g><!--MD5=[a113189431ad531dd682dcf46ceaaad4]
entity Modified--><g id="elem_Modified"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172" x="293" y="62.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="303" y="86.0352">zkevm-node modified</text></g><!--MD5=[f6b1c2ab19eda0ce2a089c48ec5bcba4]
entity New--><g id="elem_New"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="48" x="23" y="62.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="33" y="86.0352">new</text></g><!--MD5=[896ddc638b163aeba3d9eafdbb3e5908]
entity GossipExternal--><g id="elem_GossipExternal"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="66" x="1640" y="553"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1650" y="576.5352">Gossip</text></g><!--MD5=[87e9134534c374160597a990a0538c50]
entity QueryService--><g id="elem_QueryService"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="1388.5" y="770"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1398.5" y="793.5352">Query Service</text></g><!--MD5=[fc241586e3e4cf255457dad9b5d09a8f]
entity Submit--><g id="elem_Submit"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="1259" y="770"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="1269" y="793.5352">Submit API</text></g><!--MD5=[72906ce1eb61e5bac7b26d06e51547ad]
entity GossipInternal--><g id="elem_GossipInternal"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="66" x="1430" y="553"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1440" y="576.5352">Gossip</text></g><!--MD5=[657580825c081e24058a2374906e8018]
entity HotShotEvents--><g id="elem_HotShotEvents"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="1331" y="553"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1341" y="576.5352">Events</text></g><!--MD5=[6b8e50089b1fd2a85522717fdde0e9ec]
entity AdaptorSubmit--><g id="elem_AdaptorSubmit"><ellipse cx="1154" cy="788" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="1073" y="818.5352">JSON-RPC (submit only)</text></g><!--MD5=[02772cf4a850889cc654a495925d36fb]
entity Rollup--><g id="elem_Rollup"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="970.5" y="981.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="980.5" y="1005.0352">Rollup Contract</text></g><g id="elem_GMN23"><path d="M617,964 L617,1035.2422 A0,0 0 0 0 617,1035.2422 L935,1035.2422 A0,0 0 0 0 935,1035.2422 L935,1003.5 L970.12,999.5 L935,995.5 L935,974 L925,964 L617,964 A0,0 0 0 0 617,964 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M925,964 L925,974 L935,974 L925,964 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="623" y="981.5684">Contract modified to store batch commitments</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="623" y="996.8789">instead of batches. ForceBatches replaced by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="623" y="1012.1895">Sequence, which validates a QC and stores a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="623" y="1027.5">batch commitment (associated with a GER).</text></g><!--MD5=[ee57f16ef1ba8b49a548a5b41deaf6ed]
entity JsonRPC--><g id="elem_JsonRPC"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76" x="968" y="62.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="978" y="86.0352">JsonRPC</text></g><g id="elem_GMN28"><path d="M687,60 L687,100.6211 A0,0 0 0 0 687,100.6211 L933,100.6211 A0,0 0 0 0 933,100.6211 L933,84.5 L967.64,80.5 L933,76.5 L933,70 L923,60 L687,60 A0,0 0 0 0 687,60 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M923,60 L923,70 L933,70 L923,60 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="693" y="77.5684">Configured to forward transactions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="693" y="92.8789">to the Submit API of the L2 adaptor.</text></g><!--MD5=[58f3bb20197d49c7ea139ae014477a42]
entity L2DB--><g id="elem_L2DB"><path d="M908.5,222 C908.5,212 976,212 976,212 C976,212 1043.5,212 1043.5,222 L1043.5,247.4883 C1043.5,257.4883 976,257.4883 976,257.4883 C976,257.4883 908.5,257.4883 908.5,247.4883 L908.5,222 " fill="#98FB98" style="stroke:#181818;stroke-width:0.5;"/><path d="M908.5,222 C908.5,232 976,232 976,232 C976,232 1043.5,232 1043.5,222 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="918.5" y="249.5352">L2 Blockchain DB</text></g><!--MD5=[45978046dcd5eebeac2fa904e53c0036]
entity Etherman--><g id="elem_Etherman"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86" x="920" y="770"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="930" y="793.5352">Etherman</text></g><g id="elem_GMN37"><path d="M559.5,760 L559.5,815.9316 A0,0 0 0 0 559.5,815.9316 L884.5,815.9316 A0,0 0 0 0 884.5,815.9316 L884.5,792 L919.66,788 L884.5,784 L884.5,770 L874.5,760 L559.5,760 A0,0 0 0 0 559.5,760 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M874.5,760 L874.5,770 L884.5,770 L874.5,760 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="565.5" y="777.5684">Etherman modified to fetch batch commits,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="565.5" y="792.8789">not batches, from contract, and to fetch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="565.5" y="808.1895">the full batches from the HotShot Query Service.</text></g><!--MD5=[30dc00a6e98b45ee3ed5a73adbca65de]
entity Aggregator--><g id="elem_Aggregator"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="552.5" y="62.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="562.5" y="86.0352">Aggregator</text></g><!--MD5=[5c691934b5633fdd3b98f008c74cebb5]
entity State--><g id="elem_State"><rect fill="#98FB98" height="52.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="777.5" y="208"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34" x="787.5" y="231.5352">State</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="787.5" y="248.0234">Library</text></g><!--MD5=[a72c5f357cbb840cbfe5ce2fc3e89c42]
entity Synchronizer--><g id="elem_Synchronizer"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="558" y="553"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="568" y="576.5352">Synchronizer</text></g><!--MD5=[c3bd79b6cca3d8fa787b3b807ac7237d]
entity Prover--><g id="elem_Prover"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="703" y="553"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="713" y="576.5352">Prover</text></g><!--MD5=[77b6810f9f1d8e17e1346401c10c77dc]
entity Executor--><g id="elem_Executor"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="938.5" y="553"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="948.5" y="576.5352">Executor</text></g><!--MD5=[47b51ac2f4ace7439b689a6295ba6363]
entity Tree--><g id="elem_Tree"><path d="M802.5,550 C802.5,540 853,540 853,540 C853,540 903.5,540 903.5,550 L903.5,591.9766 C903.5,601.9766 853,601.9766 853,601.9766 C853,601.9766 802.5,601.9766 802.5,591.9766 L802.5,550 " fill="#98FB98" style="stroke:#181818;stroke-width:0.5;"/><path d="M802.5,550 C802.5,560 853,560 853,560 C853,560 903.5,560 903.5,550 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="812.5" y="577.5352">L2 State DB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="812.5" y="594.0234">Merkle Tree</text></g><!--MD5=[fee662a292a0353a69bd162820bae93b]
entity User--><g id="elem_User"><rect fill="#FFFFFF" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51" x="1145.5" y="62.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="1155.5" y="86.0352">User</text></g><!--MD5=[12c5fa856046bf0246c20874f4cc4349]
link New to Original--><!--MD5=[e97aaf9ac7fa8317af7932e9b00233fd]
link Original to Modified--><!--MD5=[41bf5c2ff0458362cd2ec6a26f1e4ae9]
link User to JsonRPC--><g id="link_User_JsonRPC"><path d="M1145.26,80.5 C1119.99,80.5 1080.93,80.5 1050.6,80.5 " fill="none" id="User-to-JsonRPC" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1045.78,80.5,1054.78,84.5,1050.78,80.5,1054.78,76.5,1045.78,80.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="1069.25" y="59.0684">EVM txn</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1062.25" y="74.3789">EVM query</text></g><!--MD5=[25a8f604996bf663d635e78c01298fb3]
link JsonRPC to AdaptorSubmit--><g id="link_JsonRPC_AdaptorSubmit"><path d="M1015.47,98.94 C1027.99,122.82 1049.77,167.37 1061,208 C1118.91,417.51 995.93,517.37 1124,693 C1128.92,699.75 1136.01,694.3 1141,701 C1156.67,722.03 1157.06,754.1 1155.69,772.56 " fill="none" id="JsonRPC-to-AdaptorSubmit" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1155.27,777.19,1160.0751,768.5928,1155.7265,772.2109,1152.1085,767.8624,1155.27,777.19" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="1078" y="319.5684">EVM txn</text></g><!--MD5=[2e93ea666b9199fc093ceb8bdb09fe81]
link AdaptorSubmit to Submit--><g id="link_AdaptorSubmit_Submit"><path d="M1163.05,788 C1180.37,788 1219.39,788 1252.29,788 " fill="none" id="AdaptorSubmit-to-Submit" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1257.27,788,1248.27,784,1252.27,788,1248.27,792,1257.27,788" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="1185.5" y="781.5684">EVM txn</text></g><!--MD5=[91cafd777a61df7305284aff3f8c2f32]
link GossipInternal to GossipExternal--><g id="link_GossipInternal_GossipExternal"><path d="M1502.66,571 C1546.14,571 1589.62,571 1633.09,571 " fill="none" id="GossipInternal-GossipExternal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1497.74,571,1506.74,575,1502.74,571,1506.74,567,1497.74,571" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1638,571,1629,567,1633,571,1629,575,1638,571" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[0beadb0f8f8b648fe3685e1f42645ee9]
link QueryService to Adaptor--><g id="link_QueryService_Adaptor"><path d="M1435.32,769.55 C1423.31,748.79 1400.74,716.02 1371,701 C1339.79,685.24 1151.81,670.69 1128,690.5 C1120.0625,697.1075 1114.8569,705.9738 1111.5386,715.6769 C1111.4349,715.9801 1111.333,716.2841 1111.233,716.589 " fill="none" id="QueryService-to-Adaptor" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1111.233,716.589,1117.84,709.285,1112.7921,711.8383,1110.2389,706.7904,1111.233,716.589" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="1129" y="682.0684">batch_commit</text></g><!--MD5=[8170ee5a3887cbb09eb1ab2db1c65a5d]
link Adaptor to Rollup--><g id="link_Adaptor_Rollup"><path d="M1098.1682,821.6129 C1098.0818,821.8512 1097.995,822.0905 1097.9079,822.3307 C1097.7336,822.8111 1097.5579,823.2954 1097.3809,823.7834 C1095.9649,827.6873 1094.4622,831.8302 1092.8903,836.1638 C1089.7464,844.8309 1086.3256,854.2613 1082.7675,864.07 C1068.535,903.305 1052.105,948.595 1042.41,975.32 " fill="none" id="Adaptor-to-Rollup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1040.81,979.73,1047.6327,972.6272,1042.5107,975.0281,1040.1097,969.9061,1040.81,979.73" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="1084" y="883.0684">Sequence(batch_commit, QC)</text></g><!--MD5=[a8703da4667deee7d0af4e44f6a9eb71]
link JsonRPC to State--><g id="link_JsonRPC_State"><path d="M983.63,98.94 C950.75,124.56 888.96,172.73 848.91,203.95 " fill="none" id="JsonRPC-to-State" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="845.33,206.74,854.8881,204.3648,849.2745,203.6673,849.9719,198.0536,845.33,206.74" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="938" y="159.5684">EVM query</text></g><!--MD5=[23b06c96c58f9e52170abd90e351db28]
link State to L2DB--><g id="link_State_L2DB"><path d="M844.79,234.5 C861.29,234.5 881.85,234.5 901.76,234.5 " fill="none" id="State-to-L2DB" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="906.68,234.5,897.68,230.5,901.68,234.5,897.68,238.5,906.68,234.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="863" y="228.0684">read</text></g><!--MD5=[afe8f3baa15dd48ff669bede90c045bc]
link State to Tree--><g id="link_State_Tree"><path d="M814.26,261.47 C821.67,320.5 839.81,464.94 848.37,533.16 " fill="none" id="State-to-Tree" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="848.98,538.02,851.8461,528.5974,848.3668,533.0577,843.9065,529.5785,848.98,538.02" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="824" y="319.5684">accounts</text></g><!--MD5=[723ab0c1c62c5caa555c3ea1e025083c]
link State to Executor--><g id="link_State_Executor"><path d="M844.72,254.46 C859.81,264.06 877.06,276.71 890,291 C958.07,366.18 974.1,493.59 977.85,546.19 " fill="none" id="State-to-Executor" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="978.17,551.01,981.5695,541.7664,977.8412,546.0208,973.5868,542.2925,978.17,551.01" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="922" y="319.5684">call, etc.</text></g><!--MD5=[9c0e57ae8e5f1edce66b3ebcdb296dbe]
link Aggregator to State--><g id="link_Aggregator_State"><path d="M625.97,98.94 C661.73,124.94 729.39,174.15 772.23,205.3 " fill="none" id="Aggregator-to-State" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="776.11,208.12,771.1876,199.5894,772.0676,205.1774,766.4796,206.0574,776.11,208.12" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="736" y="144.5684">fetch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="732" y="159.8789">prover</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="735.5" y="175.1895">input</text></g><!--MD5=[5351e065096d48a231f9189815b4e2c0]
link Aggregator to Etherman--><g id="link_Aggregator_Etherman"><path d="M592.41,98.78 C552.08,174.05 404.46,477.31 541,653 C585.19,709.86 626.74,682.64 698,693 C720.45,696.26 882.06,690.19 902,701 C927.05,714.57 944.19,743.43 953.77,763.97 " fill="none" id="Aggregator-to-Etherman" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="955.77,768.4,955.75,758.5512,953.73,763.8351,948.4461,761.8151,955.77,768.4" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="513" y="319.5684">proof</text></g><!--MD5=[134f1ee58a0da627c1fcf646a8cf7cfa]
link Aggregator to Prover--><g id="link_Aggregator_Prover"><path d="M601.14,98.98 C599.87,144.96 603.07,270.39 670,338 C679.41,347.5 690.08,336.04 699,346 C749.72,402.62 744.43,501.19 738.75,546.27 " fill="none" id="Aggregator-to-Prover" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="738.11,551.02,743.258,542.6237,738.7671,546.0634,735.3274,541.5724,738.11,551.02" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="624" y="232.0684">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="634" y="247.3789">proof</text></g><!--MD5=[0ca7d036d4fc0c343f6b4beaa6721ac7]
link Etherman to Rollup--><g id="link_Etherman_Rollup"><path d="M971.44,806.43 C978.32,821.05 988.01,842.6 995,862 C1008.99,900.86 1021.38,947.33 1028.26,974.8 " fill="none" id="Etherman-to-Rollup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1029.45,979.56,1031.1477,969.8586,1028.2373,974.7093,1023.3866,971.7989,1029.45,979.56" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="1005" y="883.0684">proof</text></g><!--MD5=[a4d6cd79a155cfbcb323877c4aae9e64]
reverse link Etherman to Rollup--><g id="link_Etherman_Rollup"><path d="M943.72,811.07 C932.07,824.02 916.68,840.44 902,854 C897.82,857.86 894.47,856.87 892,862 C885.84,874.82 882.62,883.31 892,894 C901.02,904.28 941.01,895.43 953,902 C986.57,920.4 1012.09,958.74 1024.89,981.16 " fill="none" id="Etherman-backto-Rollup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="946.83,807.6,937.8438,811.6309,943.4923,811.3228,943.8004,816.9713,946.83,807.6" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="898" y="875.5684">batch commit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="893" y="890.8789">global exit root</text></g><!--MD5=[810ae2e56b1a1fb5f1b627e5f98912dd]
reverse link Etherman to QueryService--><g id="link_Etherman_QueryService"><path d="M985.82,765.56 C1008.6,744.74 1045.63,714.94 1084,701 C1159.11,673.71 1183.68,686.61 1263.5,690.5 C1311.45,692.84 1328.46,678.76 1371,701 C1400.52,716.43 1423.17,749.08 1435.24,769.7 " fill="none" id="Etherman-backto-QueryService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="982.3,768.83,991.6212,765.6496,985.9685,765.4327,986.1855,759.78,982.3,768.83" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="1227.5" y="682.0684">batch</text></g><!--MD5=[072d55d1719c6ddeff0aa0b488c75fd6]
reverse link Synchronizer to Etherman--><g id="link_Synchronizer_Etherman"><path d="M627.62,594.49 C640.89,613.05 662.14,638.6 687,653 C771.72,702.08 820.47,646.79 902,701 C927.61,718.03 945.88,749.74 955.41,769.54 " fill="none" id="Synchronizer-backto-Etherman" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="624.96,590.7,626.8465,600.3665,627.8283,594.7955,633.3993,595.7773,624.96,590.7" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="919" y="674.5684">batch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="888" y="689.8789">global exit root</text></g><!--MD5=[e6872b51cd447c4cbbb81a6b7ab368dd]
reverse link State to Synchronizer--><g id="link_State_Synchronizer"><path d="M771.31,250.27 C751.1,259.44 727.41,272.95 711,291 C639.17,370.02 619.37,504.81 614.47,552.59 " fill="none" id="State-backto-Synchronizer" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="775.8,248.29,765.9512,248.2585,771.2245,250.3061,769.1769,255.5794,775.8,248.29" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="743" y="304.5684">batch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="712" y="319.8789">global exit root</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="745" y="335.1895">state</text></g><!--MD5=[eb6b988b0512d6b84233d2583692179c]
reverse link App to Submit--><g id="link_App_Submit"><path d="M1290.007,637.4957 C1290.0407,637.8114 1290.0746,638.1277 1290.1085,638.4445 C1290.6506,643.5136 1291.2081,648.7261 1291.775,654.0263 C1296.31,696.4275 1301.445,744.44 1304.13,769.56 " fill="none" id="App-backto-Submit" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1290.007,637.4957,1286.9868,646.8701,1290.5387,642.4674,1294.9414,646.0193,1290.007,637.4957" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="1296" y="682.0684">wrap in HotShot txn</text></g><!--MD5=[0f82fb44ee7a38c1b38d5c85faa7342f]
link HotShotEvents to QueryService--><g id="link_HotShotEvents_QueryService"><path d="M1369.97,589.29 C1377.99,607.29 1392.71,635.28 1413,653 C1419.59,658.76 1425.83,653.93 1431,661 C1452.9,690.93 1452.03,736.04 1448.89,763.39 " fill="none" id="HotShotEvents-to-QueryService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1448.29,768.1,1453.4142,759.6892,1448.933,763.1415,1445.4807,758.6603,1448.29,768.1" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[02608ba6a1b91bd7134cb13fae05cb24]
@startuml
skinparam componentStyle rectangle

frame Legend {
  component "zkevm-node "as is"" as Original #PaleGreen
  component "zkevm-node modified" as Modified #LightPink
  component "new" as New
}

New -[hidden]r-> Original
Original -[hidden]r-> Modified

component User #White
package "HotShot\n(other instances)" as HotShotExternal {
  component "Gossip" as GossipExternal
}

package "Decentralized Sequencer" {
  package "zkEVM app" as zkApp {
    component "Query Service" as QueryService
    component "Submit API" as Submit
    package "Txn-ordering HotShot app" as App {
      package HotShot {
        component "Gossip" as GossipInternal
        component "Events" as HotShotEvents
      }
    }
  }
}

package "L2 Adaptor" as Adaptor {
  interface "JSON-RPC (submit only)" as AdaptorSubmit
}

package "Ethereum L1" as L1 {
  component "Rollup Contract" as Rollup #LightPink
  note left of Rollup
    Contract modified to store batch commitments
    instead of batches. ForceBatches replaced by
    Sequence, which validates a QC and stores a
    batch commitment (associated with a GER).
  end note
  ' component "Bridge L1" as BridgeL1 #PaleGreen
}


package "L2 (zkevm-node)" as L2 {
  component JsonRPC #PaleGreen
  note left of JsonRPC
    Configured to forward transactions
    to the Submit API of the L2 adaptor.
  end note
  database L2DB #PaleGreen [
    L2 Blockchain DB
  ]
  package "Hermez Prover" as HermezProver {
    component Prover #PaleGreen
    component Executor #PaleGreen
    database Tree #PaleGreen [
      L2 State DB
      Merkle Tree
    ]
  }
  'component "Bridge L2" as BridgeL2 #PaleGreen
  component Etherman #LightPink
  note left of Etherman
    Etherman modified to fetch batch commits,
    not batches, from contract, and to fetch
    the full batches from the HotShot Query Service.
  end note
  component Aggregator #PaleGreen
  component "State\nLibrary" as State #PaleGreen
  component Synchronizer #PaleGreen
}

User -> JsonRPC: EVM txn\nEVM query
'User -[hidden]> Submit
'positions the User box in a better place
'User -[hidden]> L2

JsonRPC -> AdaptorSubmit: EVM txn
AdaptorSubmit -> Submit: EVM txn

GossipInternal <-> GossipExternal

QueryService -> Adaptor: batch_commit
Adaptor -> Rollup: Sequence(batch_commit, QC)

JsonRPC - -> State: EVM query

State -> L2DB: read
State - -> Tree: accounts
State - -> Executor: call, etc.

Aggregator - -> State: fetch\nprover\ninput
Aggregator - -> Etherman: proof
Aggregator - -> Prover: generate\nproof
Etherman - -> Rollup: proof
Etherman <- Rollup: batch commit\nglobal exit root
Etherman <- QueryService: batch
Synchronizer <- - Etherman: batch\nglobal exit root
State <- - Synchronizer: batch\nglobal exit root\nstate

' Prover ..> BridgeL2
' User - -> BridgeL1
Submit -up-> App: wrap in HotShot txn
HotShotEvents -down-> QueryService

@enduml

@startuml
skinparam componentStyle rectangle

frame Legend {
  component "zkevm-node "as is"" as Original #PaleGreen
  component "zkevm-node modified" as Modified #LightPink
  component "new" as New
}

New -[hidden]r-> Original
Original -[hidden]r-> Modified

component User #White
package "HotShot\n(other instances)" as HotShotExternal {
  component "Gossip" as GossipExternal
}

package "Decentralized Sequencer" {
  package "zkEVM app" as zkApp {
    component "Query Service" as QueryService
    component "Submit API" as Submit
    package "Txn-ordering HotShot app" as App {
      package HotShot {
        component "Gossip" as GossipInternal
        component "Events" as HotShotEvents
      }
    }
  }
}

package "L2 Adaptor" as Adaptor {
  interface "JSON-RPC (submit only)" as AdaptorSubmit
}

package "Ethereum L1" as L1 {
  component "Rollup Contract" as Rollup #LightPink
  note left of Rollup
    Contract modified to store batch commitments
    instead of batches. ForceBatches replaced by
    Sequence, which validates a QC and stores a
    batch commitment (associated with a GER).
  end note
}


package "L2 (zkevm-node)" as L2 {
  component JsonRPC #PaleGreen
  note left of JsonRPC
    Configured to forward transactions
    to the Submit API of the L2 adaptor.
  end note
  database L2DB #PaleGreen [
    L2 Blockchain DB
  ]
  package "Hermez Prover" as HermezProver {
    component Prover #PaleGreen
    component Executor #PaleGreen
    database Tree #PaleGreen [
      L2 State DB
      Merkle Tree
    ]
  }
  component Etherman #LightPink
  note left of Etherman
    Etherman modified to fetch batch commits,
    not batches, from contract, and to fetch
    the full batches from the HotShot Query Service.
  end note
  component Aggregator #PaleGreen
  component "State\nLibrary" as State #PaleGreen
  component Synchronizer #PaleGreen
}

User -> JsonRPC: EVM txn\nEVM query

JsonRPC -> AdaptorSubmit: EVM txn
AdaptorSubmit -> Submit: EVM txn

GossipInternal <-> GossipExternal

QueryService -> Adaptor: batch_commit
Adaptor -> Rollup: Sequence(batch_commit, QC)

JsonRPC - -> State: EVM query

State -> L2DB: read
State - -> Tree: accounts
State - -> Executor: call, etc.

Aggregator - -> State: fetch\nprover\ninput
Aggregator - -> Etherman: proof
Aggregator - -> Prover: generate\nproof
Etherman - -> Rollup: proof
Etherman <- Rollup: batch commit\nglobal exit root
Etherman <- QueryService: batch
Synchronizer <- - Etherman: batch\nglobal exit root
State <- - Synchronizer: batch\nglobal exit root\nstate

Submit -up-> App: wrap in HotShot txn
HotShotEvents -down-> QueryService

@enduml

PlantUML version 1.2022.13(Sat Nov 19 05:22:17 PST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>