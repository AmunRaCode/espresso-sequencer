<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1226px" preserveAspectRatio="none" style="width:1397px;height:1226px;background:#FFFFFF;" version="1.1" viewBox="0 0 1397 1226" width="1397px" zoomAndPan="magnify"><defs/><g><!--MD5=[f7217341b3bb6bbf768c7f0e049f8d09]
cluster Legend--><g id="cluster_Legend"><rect fill="none" height="106" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1.0;" width="474" x="121" y="151"/><path d="M182,151 L182,160.4883 L172,170.4883 L121,170.4883 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="51" x="124" y="165.5352">Legend</text></g><!--MD5=[3746f487d7820090e32c72dc756be46d]
cluster HotShotExternal--><g id="cluster_HotShotExternal"><path d="M1255.5,119 L1377.5,119 A3.75,3.75 0 0 1 1380,121.5 L1387,157.9766 L1387.5,157.9766 A2.5,2.5 0 0 1 1390,160.4766 L1390,254.5 A2.5,2.5 0 0 1 1387.5,257 L1255.5,257 A2.5,2.5 0 0 1 1253,254.5 L1253,121.5 A2.5,2.5 0 0 1 1255.5,119 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1253" x2="1387" y1="157.9766" y2="157.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="58" x="1288.5" y="134.5352">HotShot</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="121" x="1257" y="151.0234">(other instances)</text></g><!--MD5=[074479fc2b8718e85f223949db21494f]
cluster Decentralized Sequencer--><g id="cluster_Decentralized Sequencer"><path d="M850.5,6 L1026.5,6 A3.75,3.75 0 0 1 1029,8.5 L1036,28.4883 L1226.5,28.4883 A2.5,2.5 0 0 1 1229,30.9883 L1229,491 A2.5,2.5 0 0 1 1226.5,493.5 L850.5,493.5 A2.5,2.5 0 0 1 848,491 L848,8.5 A2.5,2.5 0 0 1 850.5,6 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="848" x2="1036" y1="28.4883" y2="28.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="175" x="852" y="21.5352">Decentralized Sequencer</text></g><!--MD5=[bcfbdd31683a7d01cd062dc0c4be3661]
cluster zkApp--><g id="cluster_zkApp"><path d="M874.5,49 L954.5,49 A3.75,3.75 0 0 1 957,51.5 L964,71.4883 L1202.5,71.4883 A2.5,2.5 0 0 1 1205,73.9883 L1205,467 A2.5,2.5 0 0 1 1202.5,469.5 L874.5,469.5 A2.5,2.5 0 0 1 872,467 L872,51.5 A2.5,2.5 0 0 1 874.5,49 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="872" x2="964" y1="71.4883" y2="71.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="79" x="876" y="64.5352">zkEVM app</text></g><!--MD5=[975d7fda8cf98ff1a26ca528bf10cecf]
cluster App--><g id="cluster_App"><path d="M906.5,100 L1098.5,100 A3.75,3.75 0 0 1 1101,102.5 L1108,122.4883 L1170.5,122.4883 A2.5,2.5 0 0 1 1173,124.9883 L1173,286.5 A2.5,2.5 0 0 1 1170.5,289 L906.5,289 A2.5,2.5 0 0 1 904,286.5 L904,102.5 A2.5,2.5 0 0 1 906.5,100 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="904" x2="1108" y1="122.4883" y2="122.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="191" x="908" y="115.5352">Txn-ordering HotShot app</text></g><!--MD5=[583d55fc1e2a49743832e160d5573292]
cluster HotShot--><g id="cluster_HotShot"><path d="M946.5,151 L1005.5,151 A3.75,3.75 0 0 1 1008,153.5 L1015,173.4883 L1138.5,173.4883 A2.5,2.5 0 0 1 1141,175.9883 L1141,254.5 A2.5,2.5 0 0 1 1138.5,257 L946.5,257 A2.5,2.5 0 0 1 944,254.5 L944,153.5 A2.5,2.5 0 0 1 946.5,151 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="944" x2="1015" y1="173.4883" y2="173.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="58" x="948" y="166.5352">HotShot</text></g><!--MD5=[4499c58aefeb8777a4ef8729a6b9746a]
cluster L1--><g id="cluster_L1"><path d="M101.5,1078.5 L192.5,1078.5 A3.75,3.75 0 0 1 195,1081 L202,1100.9883 L609.5,1100.9883 A2.5,2.5 0 0 1 612,1103.4883 L612,1217 A2.5,2.5 0 0 1 609.5,1219.5 L101.5,1219.5 A2.5,2.5 0 0 1 99,1217 L99,1081 A2.5,2.5 0 0 1 101.5,1078.5 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="99" x2="202" y1="1100.9883" y2="1100.9883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="90" x="103" y="1094.0352">Ethereum L1</text></g><!--MD5=[30107c386ad61863a1077fa9b8608265]
cluster L2--><g id="cluster_L2"><path d="M45.5,361 L169.5,361 A3.75,3.75 0 0 1 172,363.5 L179,383.4883 L821.5,383.4883 A2.5,2.5 0 0 1 824,385.9883 L824,1012 A2.5,2.5 0 0 1 821.5,1014.5 L45.5,1014.5 A2.5,2.5 0 0 1 43,1012 L43,363.5 A2.5,2.5 0 0 1 45.5,361 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="43" x2="179" y1="383.4883" y2="383.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123" x="47" y="376.5352">L2 (zkevm-node)</text></g><!--MD5=[72078431e26b572f5b2226d95bfc722b]
cluster HermezProver--><g id="cluster_HermezProver"><path d="M332.5,732.5 L439.5,732.5 A3.75,3.75 0 0 1 442,735 L449,754.9883 L676.5,754.9883 A2.5,2.5 0 0 1 679,757.4883 L679,862 A2.5,2.5 0 0 1 676.5,864.5 L332.5,864.5 A2.5,2.5 0 0 1 330,862 L330,735 A2.5,2.5 0 0 1 332.5,732.5 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="330" x2="449" y1="754.9883" y2="754.9883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="106" x="334" y="748.0352">Hermez Prover</text></g><!--MD5=[72d9b9c3df19f32920b704ceb461b044]
entity Original--><g id="elem_Original"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="220.5" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="230.5" y="228.5352">zkevm-node "as is"</text></g><!--MD5=[a113189431ad531dd682dcf46ceaaad4]
entity Modified--><g id="elem_Modified"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172" x="407" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="417" y="228.5352">zkevm-node modified</text></g><!--MD5=[f6b1c2ab19eda0ce2a089c48ec5bcba4]
entity New--><g id="elem_New"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="48" x="137" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="147" y="228.5352">new</text></g><!--MD5=[896ddc638b163aeba3d9eafdbb3e5908]
entity GossipExternal--><g id="elem_GossipExternal"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="66" x="1269" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1279" y="228.5352">Gossip</text></g><!--MD5=[87e9134534c374160597a990a0538c50]
entity QueryService--><g id="elem_QueryService"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="1017.5" y="417.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1027.5" y="441.0352">Query Service</text></g><!--MD5=[fc241586e3e4cf255457dad9b5d09a8f]
entity Submit--><g id="elem_Submit"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="888" y="417.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="898" y="441.0352">Submit API</text></g><!--MD5=[72906ce1eb61e5bac7b26d06e51547ad]
entity GossipInternal--><g id="elem_GossipInternal"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="66" x="1059" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1069" y="228.5352">Gossip</text></g><!--MD5=[657580825c081e24058a2374906e8018]
entity HotShotEvents--><g id="elem_HotShotEvents"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="960" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="970" y="228.5352">Events</text></g><!--MD5=[02772cf4a850889cc654a495925d36fb]
entity Rollup--><g id="elem_Rollup"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="468.5" y="1150"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="478.5" y="1173.5352">Rollup Contract</text></g><g id="elem_GMN21"><path d="M115,1132.5 L115,1203.7422 A0,0 0 0 0 115,1203.7422 L433,1203.7422 A0,0 0 0 0 433,1203.7422 L433,1172 L468.12,1168 L433,1164 L433,1142.5 L423,1132.5 L115,1132.5 A0,0 0 0 0 115,1132.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M423,1132.5 L423,1142.5 L433,1142.5 L423,1132.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="121" y="1150.0684">Contract modified to store batch commitments</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="121" y="1165.3789">instead of batches. ForceBatches replaced by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="121" y="1180.6895">Sequence, which validates a QC and stores a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="121" y="1196">batch commitment (associated with a GER).</text></g><!--MD5=[ee57f16ef1ba8b49a548a5b41deaf6ed]
entity JsonRPC--><g id="elem_JsonRPC"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76" x="724" y="417.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="734" y="441.0352">JsonRPC</text></g><g id="elem_GMN26"><path d="M461.5,415 L461.5,455.6211 A0,0 0 0 0 461.5,455.6211 L688.5,455.6211 A0,0 0 0 0 688.5,455.6211 L688.5,439.5 L723.76,435.5 L688.5,431.5 L688.5,425 L678.5,415 L461.5,415 A0,0 0 0 0 461.5,415 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M678.5,415 L678.5,425 L688.5,425 L678.5,415 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="467.5" y="432.5684">Modified to forward transactions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="467.5" y="447.8789">to the HotShot submit API.</text></g><!--MD5=[58f3bb20197d49c7ea139ae014477a42]
entity L2DB--><g id="elem_L2DB"><path d="M672.5,600.5 C672.5,590.5 740,590.5 740,590.5 C740,590.5 807.5,590.5 807.5,600.5 L807.5,625.9883 C807.5,635.9883 740,635.9883 740,635.9883 C740,635.9883 672.5,635.9883 672.5,625.9883 L672.5,600.5 " fill="#98FB98" style="stroke:#181818;stroke-width:0.5;"/><path d="M672.5,600.5 C672.5,610.5 740,610.5 740,610.5 C740,610.5 807.5,610.5 807.5,600.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="682.5" y="628.0352">L2 Blockchain DB</text></g><!--MD5=[45978046dcd5eebeac2fa904e53c0036]
entity Etherman--><g id="elem_Etherman"><rect fill="#FFB6C1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86" x="565" y="952.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="575" y="976.0352">Etherman</text></g><g id="elem_GMN35"><path d="M204.5,942.5 L204.5,998.4316 A0,0 0 0 0 204.5,998.4316 L529.5,998.4316 A0,0 0 0 0 529.5,998.4316 L529.5,974.5 L564.66,970.5 L529.5,966.5 L529.5,952.5 L519.5,942.5 L204.5,942.5 A0,0 0 0 0 204.5,942.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M519.5,942.5 L519.5,952.5 L529.5,952.5 L519.5,942.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="210.5" y="960.0684">Etherman modified to fetch batch commits,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="210.5" y="975.3789">not batches, from contract, and to fetch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="210.5" y="990.6895">the full batches from the HotShot Query Service.</text></g><!--MD5=[30dc00a6e98b45ee3ed5a73adbca65de]
entity Aggregator--><g id="elem_Aggregator"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="327.5" y="417.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="337.5" y="441.0352">Aggregator</text></g><!--MD5=[5c691934b5633fdd3b98f008c74cebb5]
entity State--><g id="elem_State"><rect fill="#98FB98" height="52.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="541.5" y="586.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34" x="551.5" y="610.0352">State</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="551.5" y="626.5234">Library</text></g><!--MD5=[a72c5f357cbb840cbfe5ce2fc3e89c42]
entity Synchronizer--><g id="elem_Synchronizer"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="698" y="799.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="708" y="823.0352">Synchronizer</text></g><!--MD5=[d0d4390cccd27050d5c855d0d0eb3000]
entity BatchWriter--><g id="elem_BatchWriter"><rect fill="#F1F1F1" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="170" y="417.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="180" y="441.0352">Batch Writer</text></g><g id="elem_GMN42"><path d="M59,592.5 L59,633.1211 A0,0 0 0 0 59,633.1211 L343,633.1211 A0,0 0 0 0 343,633.1211 L343,602.5 L333,592.5 L207.26,592.5 L219.01,453.97 L199.26,592.5 L59,592.5 A0,0 0 0 0 59,592.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M333,592.5 L333,602.5 L343,602.5 L333,592.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="65" y="610.0684">New component which scans blocks from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="65" y="625.3789">HotShot and writes them to the contract.</text></g><!--MD5=[c3bd79b6cca3d8fa787b3b807ac7237d]
entity Prover--><g id="elem_Prover"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="346" y="799.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="356" y="823.0352">Prover</text></g><!--MD5=[77b6810f9f1d8e17e1346401c10c77dc]
entity Executor--><g id="elem_Executor"><rect fill="#98FB98" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="445.5" y="799.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="455.5" y="823.0352">Executor</text></g><!--MD5=[47b51ac2f4ace7439b689a6295ba6363]
entity Tree--><g id="elem_Tree"><path d="M561.5,796.5 C561.5,786.5 612,786.5 612,786.5 C612,786.5 662.5,786.5 662.5,796.5 L662.5,838.4766 C662.5,848.4766 612,848.4766 612,848.4766 C612,848.4766 561.5,848.4766 561.5,838.4766 L561.5,796.5 " fill="#98FB98" style="stroke:#181818;stroke-width:0.5;"/><path d="M561.5,796.5 C561.5,806.5 612,806.5 612,806.5 C612,806.5 662.5,806.5 662.5,796.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="571.5" y="824.0352">L2 State DB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="571.5" y="840.5234">Merkle Tree</text></g><!--MD5=[fee662a292a0353a69bd162820bae93b]
entity User--><g id="elem_User"><rect fill="#FFFFFF" height="36.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51" x="736.5" y="205"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="746.5" y="228.5352">User</text></g><!--MD5=[12c5fa856046bf0246c20874f4cc4349]
link New to Original--><!--MD5=[e97aaf9ac7fa8317af7932e9b00233fd]
link Original to Modified--><!--MD5=[41bf5c2ff0458362cd2ec6a26f1e4ae9]
link User to JsonRPC--><g id="link_User_JsonRPC"><path d="M762,241.23 C762,278.69 762,367.67 762,410.56 " fill="none" id="User-to-JsonRPC" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="762,415.52,766,406.52,762,410.52,758,406.52,762,415.52" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="770" y="326.5684">EVM txn</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="763" y="341.8789">EVM query</text></g><!--MD5=[fb267e17b24e3cdcec4d04de63f929e9]
link JsonRPC to Submit--><g id="link_JsonRPC_Submit"><path d="M800.39,435.5 C824.26,435.5 855.3,435.5 881.55,435.5 " fill="none" id="JsonRPC-to-Submit" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="886.25,435.5,877.25,431.5,881.25,435.5,877.25,439.5,886.25,435.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="818.5" y="429.0684">EVM txn</text></g><!--MD5=[91cafd777a61df7305284aff3f8c2f32]
link GossipInternal to GossipExternal--><g id="link_GossipInternal_GossipExternal"><path d="M1131.66,223 C1175.14,223 1218.62,223 1262.09,223 " fill="none" id="GossipInternal-GossipExternal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1126.74,223,1135.74,227,1131.74,223,1135.74,219,1126.74,223" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1267,223,1258,219,1262,223,1258,227,1267,223" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[7d8becca380c4a6cb0da60b6aba2f5c1]
link QueryService to BatchWriter--><g id="link_QueryService_BatchWriter"><path d="M1063.74,417.06 C1051.49,397.13 1028.98,366.42 1000,353 C978.61,343.1 619.92,333.49 447.5,341 C386.21,343.67 366.08,328.14 310,353 C280.52,366.07 254.49,392.99 238.31,412.54 " fill="none" id="QueryService-to-BatchWriter" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="235.36,416.16,244.1299,411.6779,238.5043,412.2724,237.9098,406.6469,235.36,416.16" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="448.5" y="334.0684">batch_commit, QC</text></g><!--MD5=[c4d27d58372d5606f4d8d1b1c518dbbd]
link BatchWriter to Rollup--><g id="link_BatchWriter_Rollup"><path d="M169.5,452.97 C105.9,476.92 6,527.92 6,612 C6,612 6,612 6,971.5 C6,1055.08 105.57,1003.67 187,1022.5 C303.19,1049.37 347.87,1010.61 451,1070.5 C481.34,1088.12 505.46,1121.55 519.24,1144.05 " fill="none" id="BatchWriter-to-Rollup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="521.74,1148.23,520.5395,1138.4546,519.1675,1143.9425,513.6796,1142.5705,521.74,1148.23" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="7" y="822.5684">Sequence(batch_commit, QC)</text></g><!--MD5=[a8703da4667deee7d0af4e44f6a9eb71]
link JsonRPC to State--><g id="link_JsonRPC_State"><path d="M748.2,453.99 C737.28,467.47 721.35,486.31 706,501.5 C676.53,530.66 640.34,560.81 613.47,582.24 " fill="none" id="JsonRPC-to-State" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="609.75,585.19,619.2833,582.7167,613.6627,582.077,614.3024,576.4564,609.75,585.19" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="697" y="538.0684">EVM query</text></g><!--MD5=[23b06c96c58f9e52170abd90e351db28]
link State to L2DB--><g id="link_State_L2DB"><path d="M608.79,613 C625.29,613 645.85,613 665.76,613 " fill="none" id="State-to-L2DB" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="670.68,613,661.68,609,665.68,613,661.68,617,670.68,613" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="627" y="606.5684">read</text></g><!--MD5=[afe8f3baa15dd48ff669bede90c045bc]
link State to Tree--><g id="link_State_Tree"><path d="M579.69,639.65 C586.16,675.11 597.9,739.3 605.3,779.83 " fill="none" id="State-to-Tree" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="606.18,784.63,608.4933,775.0567,605.2793,779.7118,600.6241,776.4978,606.18,784.63" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="594" y="698.0684">accounts</text></g><!--MD5=[723ab0c1c62c5caa555c3ea1e025083c]
link State to Executor--><g id="link_State_Executor"><path d="M544.87,639.91 C536.39,648.56 527.89,658.75 522,669.5 C500.17,709.35 491.4,762.43 488.02,792.69 " fill="none" id="State-to-Executor" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="487.49,797.65,492.4191,789.1233,488.0186,792.678,484.464,788.2775,487.49,797.65" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="523" y="698.0684">call, etc.</text></g><!--MD5=[9c0e57ae8e5f1edce66b3ebcdb296dbe]
link Aggregator to State--><g id="link_Aggregator_State"><path d="M392.36,453.9 C405.26,467.85 424.62,487.37 444,501.5 C450.1,505.95 452.79,505.19 459,509.5 C490.12,531.1 522.14,560 544.64,581.6 " fill="none" id="Aggregator-to-State" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="548.2,585.04,544.4979,575.9134,544.6008,581.5693,538.9449,581.6722,548.2,585.04" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="520" y="523.0684">fetch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="516" y="538.3789">prover</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="519.5" y="553.6895">input</text></g><!--MD5=[5351e065096d48a231f9189815b4e2c0]
link Aggregator to Etherman--><g id="link_Aggregator_Etherman"><path d="M378.12,453.81 C379.89,489.45 381.28,573.25 361,639.5 C356.51,654.15 349.72,655.28 344,669.5 C310.25,753.4 276.77,799.39 330,872.5 C389.65,954.42 452.31,906.39 547,942.5 C552.68,944.67 558.6,947.08 564.41,949.55 " fill="none" id="Aggregator-to-Etherman" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="568.79,951.43,562.1015,944.2006,564.1965,949.4552,558.9419,951.5502,568.79,951.43" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="345" y="698.0684">proof</text></g><!--MD5=[134f1ee58a0da627c1fcf646a8cf7cfa]
link Aggregator to Prover--><g id="link_Aggregator_Prover"><path d="M380.36,453.82 C383.03,468.56 386.56,490.33 388,509.5 C394.87,601.24 392.58,624.61 388,716.5 C386.69,742.76 383.46,772.75 381.02,792.99 " fill="none" id="Aggregator-to-Prover" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="380.44,797.69,385.4896,789.2341,381.0391,792.726,377.5472,788.2756,380.44,797.69" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="393" y="610.5684">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="403" y="625.8789">proof</text></g><!--MD5=[0ca7d036d4fc0c343f6b4beaa6721ac7]
link Etherman to Rollup--><g id="link_Etherman_Rollup"><path d="M589.74,988.9 C578.1,999.44 562.36,1012.7 547,1022.5 C539.96,1026.99 534.47,1023.45 530,1030.5 C508.16,1064.92 516.57,1114.7 524.44,1143.67 " fill="none" id="Etherman-to-Rollup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="525.79,1148.41,527.1636,1138.6574,524.4164,1143.6024,519.4714,1140.8552,525.79,1148.41" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="531" y="1051.5684">proof</text></g><!--MD5=[a4d6cd79a155cfbcb323877c4aae9e64]
reverse link Etherman to Rollup--><g id="link_Etherman_Rollup"><path d="M598.91,994.87 C583.46,1034.62 552.41,1114.51 538.73,1149.69 " fill="none" id="Etherman-backto-Rollup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="600.71,990.26,593.7415,997.2199,598.9122,994.9256,601.2065,1000.0963,600.71,990.26" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="589" y="1044.0684">batch commit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="584" y="1059.3789">global exit root</text></g><!--MD5=[810ae2e56b1a1fb5f1b627e5f98912dd]
reverse link Etherman to QueryService--><g id="link_Etherman_QueryService"><path d="M657.62,963.16 C697.86,956.09 754.5,941.56 796,912.5 C969.25,791.19 1050.55,524.59 1069.55,453.96 " fill="none" id="Etherman-backto-QueryService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="652.8,963.98,662.3386,966.4325,657.7308,963.1511,661.0123,958.5433,652.8,963.98" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="988" y="698.0684">batch</text></g><!--MD5=[072d55d1719c6ddeff0aa0b488c75fd6]
reverse link Synchronizer to Etherman--><g id="link_Synchronizer_Etherman"><path d="M731.9,840.48 C702.77,870.81 650.86,924.86 624.44,952.38 " fill="none" id="Synchronizer-backto-Etherman" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="735.32,836.91,726.2084,840.6489,731.8639,840.5232,731.9896,846.1787,735.32,836.91" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="721" y="894.0684">batch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="690" y="909.3789">global exit root</text></g><!--MD5=[e6872b51cd447c4cbbb81a6b7ab368dd]
reverse link State to Synchronizer--><g id="link_State_Synchronizer"><path d="M614.46,634.9 C629.78,644.2 646.78,656.09 660,669.5 C699.86,709.93 731.33,770.26 745.24,799.45 " fill="none" id="State-backto-Synchronizer" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="610.21,632.37,615.901,640.4082,614.5075,634.9257,619.99,633.5322,610.21,632.37" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="728" y="683.0684">batch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="697" y="698.3789">global exit root</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="730" y="713.6895">state</text></g><!--MD5=[eb6b988b0512d6b84233d2583692179c]
reverse link App to Submit--><g id="link_App_Submit"><path d="M919.1849,289.7339 C919.2188,290.0441 919.2527,290.3549 919.2867,290.6662 C919.3548,291.2888 919.423,291.9136 919.4915,292.5403 C919.6284,293.7937 919.7663,295.055 919.9049,296.3235 C920.1821,298.8604 920.4623,301.4256 920.745,304.0125 C925.2675,345.4025 930.395,392.325 933.1,417.07 " fill="none" id="App-backto-Submit" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="919.1849,289.7339,916.1861,299.1151,919.7279,294.7043,924.1387,298.2461,919.1849,289.7339" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="925" y="334.0684">wrap in HotShot txn</text></g><!--MD5=[0f82fb44ee7a38c1b38d5c85faa7342f]
link HotShotEvents to QueryService--><g id="link_HotShotEvents_QueryService"><path d="M998.97,241.29 C1006.99,259.29 1021.71,287.28 1042,305 C1048.59,310.76 1054.82,305.94 1060,313 C1080.98,341.55 1080.56,384.5 1077.72,410.95 " fill="none" id="HotShotEvents-to-QueryService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1077.14,415.8,1082.1925,407.3459,1077.7408,410.8362,1074.2504,406.3846,1077.14,415.8" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[685f10775956cec85fa29766474d98b7]
@startuml
skinparam componentStyle rectangle

frame Legend {
  component "zkevm-node "as is"" as Original #PaleGreen
  component "zkevm-node modified" as Modified #LightPink
  component "new" as New
}

New -[hidden]r-> Original
Original -[hidden]r-> Modified

component User #White
package "HotShot\n(other instances)" as HotShotExternal {
  component "Gossip" as GossipExternal
}

package "Decentralized Sequencer" {
  package "zkEVM app" as zkApp {
    component "Query Service" as QueryService
    component "Submit API" as Submit
    package "Txn-ordering HotShot app" as App {
      package HotShot {
        component "Gossip" as GossipInternal
        component "Events" as HotShotEvents
      }
    }
  }
}

package "Ethereum L1" as L1 {
  component "Rollup Contract" as Rollup #LightPink
  note left of Rollup
    Contract modified to store batch commitments
    instead of batches. ForceBatches replaced by
    Sequence, which validates a QC and stores a
    batch commitment (associated with a GER).
  end note
  ' component "Bridge L1" as BridgeL1 #PaleGreen
}


package "L2 (zkevm-node)" as L2 {
  component JsonRPC #LightPink
  note left of JsonRPC
    Modified to forward transactions
    to the HotShot submit API.
  end note
  database L2DB #PaleGreen [
    L2 Blockchain DB
  ]
  package "Hermez Prover" as HermezProver {
    component Prover #PaleGreen
    component Executor #PaleGreen
    database Tree #PaleGreen [
      L2 State DB
      Merkle Tree
    ]
  }
  'component "Bridge L2" as BridgeL2 #PaleGreen
  component Etherman #LightPink
  note left of Etherman
    Etherman modified to fetch batch commits,
    not batches, from contract, and to fetch
    the full batches from the HotShot Query Service.
  end note
  component Aggregator #PaleGreen
  component "State\nLibrary" as State #PaleGreen
  component Synchronizer #PaleGreen
  component "Batch Writer" as BatchWriter
  note bottom of BatchWriter
    New component which scans blocks from
    HotShot and writes them to the contract.
  end note
}

User -down-> JsonRPC: EVM txn\nEVM query
'User -[hidden]> Submit
'positions the User box in a better place
'User -[hidden]> L2

JsonRPC -> Submit: EVM txn

GossipInternal <-> GossipExternal

QueryService -> BatchWriter: batch_commit, QC
BatchWriter -> Rollup: Sequence(batch_commit, QC)

JsonRPC - -> State: EVM query

State -> L2DB: read
State - -> Tree: accounts
State - -> Executor: call, etc.

Aggregator - -> State: fetch\nprover\ninput
Aggregator - -> Etherman: proof
Aggregator - -> Prover: generate\nproof
Etherman - -> Rollup: proof
Etherman <- Rollup: batch commit\nglobal exit root
Etherman <- QueryService: batch
Synchronizer <- - Etherman: batch\nglobal exit root
State <- - Synchronizer: batch\nglobal exit root\nstate

' Prover ..> BridgeL2
' User - -> BridgeL1
Submit -up-> App: wrap in HotShot txn
HotShotEvents -down-> QueryService

@enduml

@startuml
skinparam componentStyle rectangle

frame Legend {
  component "zkevm-node "as is"" as Original #PaleGreen
  component "zkevm-node modified" as Modified #LightPink
  component "new" as New
}

New -[hidden]r-> Original
Original -[hidden]r-> Modified

component User #White
package "HotShot\n(other instances)" as HotShotExternal {
  component "Gossip" as GossipExternal
}

package "Decentralized Sequencer" {
  package "zkEVM app" as zkApp {
    component "Query Service" as QueryService
    component "Submit API" as Submit
    package "Txn-ordering HotShot app" as App {
      package HotShot {
        component "Gossip" as GossipInternal
        component "Events" as HotShotEvents
      }
    }
  }
}

package "Ethereum L1" as L1 {
  component "Rollup Contract" as Rollup #LightPink
  note left of Rollup
    Contract modified to store batch commitments
    instead of batches. ForceBatches replaced by
    Sequence, which validates a QC and stores a
    batch commitment (associated with a GER).
  end note
}


package "L2 (zkevm-node)" as L2 {
  component JsonRPC #LightPink
  note left of JsonRPC
    Modified to forward transactions
    to the HotShot submit API.
  end note
  database L2DB #PaleGreen [
    L2 Blockchain DB
  ]
  package "Hermez Prover" as HermezProver {
    component Prover #PaleGreen
    component Executor #PaleGreen
    database Tree #PaleGreen [
      L2 State DB
      Merkle Tree
    ]
  }
  component Etherman #LightPink
  note left of Etherman
    Etherman modified to fetch batch commits,
    not batches, from contract, and to fetch
    the full batches from the HotShot Query Service.
  end note
  component Aggregator #PaleGreen
  component "State\nLibrary" as State #PaleGreen
  component Synchronizer #PaleGreen
  component "Batch Writer" as BatchWriter
  note bottom of BatchWriter
    New component which scans blocks from
    HotShot and writes them to the contract.
  end note
}

User -down-> JsonRPC: EVM txn\nEVM query

JsonRPC -> Submit: EVM txn

GossipInternal <-> GossipExternal

QueryService -> BatchWriter: batch_commit, QC
BatchWriter -> Rollup: Sequence(batch_commit, QC)

JsonRPC - -> State: EVM query

State -> L2DB: read
State - -> Tree: accounts
State - -> Executor: call, etc.

Aggregator - -> State: fetch\nprover\ninput
Aggregator - -> Etherman: proof
Aggregator - -> Prover: generate\nproof
Etherman - -> Rollup: proof
Etherman <- Rollup: batch commit\nglobal exit root
Etherman <- QueryService: batch
Synchronizer <- - Etherman: batch\nglobal exit root
State <- - Synchronizer: batch\nglobal exit root\nstate

Submit -up-> App: wrap in HotShot txn
HotShotEvents -down-> QueryService

@enduml

PlantUML version 1.2022.13(Sat Nov 19 05:22:17 PST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>